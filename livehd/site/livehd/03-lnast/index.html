
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.2">
    
    
      
        <title>LNAST - LiveHD and Pyrope</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1118c9be.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ba0d045b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=:300,400,400i,700%7CFira+Code&display=fallback">
        <style>:root{--md-text-font-family:"";--md-code-font-family:"Fira Code"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#lnast" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LiveHD and Pyrope" class="md-header__button md-logo" aria-label="LiveHD and Pyrope" data-md-component="logo">
      
  <img src="../../assets/pyrope5.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LiveHD and Pyrope
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              LNAST
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/masc-ucsc/livehd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LiveHD and Pyrope" class="md-nav__button md-logo" aria-label="LiveHD and Pyrope" data-md-component="logo">
      
  <img src="../../assets/pyrope5.png" alt="logo">

    </a>
    LiveHD and Pyrope
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/masc-ucsc/livehd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        LiveHD and Pyrope
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Livehd
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Livehd" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Livehd
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01-install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01-usage/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../02-lgraph/" class="md-nav__link">
        LGraph
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          LNAST
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        LNAST
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#function-overloadings-of-node-data-construction" class="md-nav__link">
    Function Overloadings of Node Data Construction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#another-example" class="md-nav__link">
    Another Example
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../03c-mmapstr/" class="md-nav__link">
        mmap_lib::str
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../04a-bazel/" class="md-nav__link">
        Bazel build
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../04b-pass/" class="md-nav__link">
        Creating a Pass
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../04c-github/" class="md-nav__link">
        GitHub Guide
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../04d-style/" class="md-nav__link">
        Coding Style
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Pyrope
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Pyrope" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Pyrope
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/02-basics/" class="md-nav__link">
        Basics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/03-bundle/" class="md-nav__link">
        Bundles
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/04-variables/" class="md-nav__link">
        Variables and types
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/05-assert/" class="md-nav__link">
        Assertions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/06-functions/" class="md-nav__link">
        Functions and methods
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/06b-pipelining/" class="md-nav__link">
        Pipelining
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/07-typesystem/" class="md-nav__link">
        Type system
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/09-stdlib/" class="md-nav__link">
        Pyrope std lib
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#function-overloadings-of-node-data-construction" class="md-nav__link">
    Function Overloadings of Node Data Construction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#another-example" class="md-nav__link">
    Another Example
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="lnast">LNAST</h1>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
</div>
<p>This document is not updated to the latest changes</p>
<p>LNAST stands for Language-Neutral Abstract Syntax Tree, which is constituted of
Lnast_nodes and indexed by a tree structure.  </p>
<p>LiveHD has two main data structures: LNAST and LGraph. The LNAST is the higher
level representation with a tree structure. The LGraph is the lower level
representation with a graph structure.  Each node in LGraph has a LNAST
equivalent node, but LNAST is more high level and several nodes in LNAST may
not have a one-to-one mapping to LGraph.</p>
<p>Each Lnast_node should has a specific node type and contain the following information from source code tokens  </p>
<p>(a) line number <br />
(b) pos_start, pos_end<br />
(c) string_view (optional)  </p>
<h2 id="function-overloadings-of-node-data-construction">Function Overloadings of Node Data Construction</h2>
<p>Every node construction method has four function overloadings.<br />
For example, to construct a Lnast_node with a type of reference,<br />
we could use one of the following functions:  </p>
<div class="highlight"><pre><span></span><code><span class="c1">// C++</span>
<span class="k">auto</span> <span class="n">node_ref</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">);</span>     
<span class="k">auto</span> <span class="n">node_ref</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">);</span>     
<span class="k">auto</span> <span class="n">node_ref</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span><span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>     
<span class="k">auto</span> <span class="n">node_ref</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span><span class="p">(</span><span class="n">token</span><span class="p">);</span>   
</code></pre></div>
<p>In case (1), you only knows the variable name is "foo".<br />
In case (2), you know the variable name and the corresponding line number.<br />
In case (3), you know the variable name, the line number, and the charactrer position.<br />
In case (4), you are building LNAST from your HDL AST and you already have the Token. <br />
The toke should have line number, positions, and string_view information.  </p>
<h2 id="another-example">Another Example</h2>
<p>If you don't care the string_view to be stored in the lnast node, just leave it empty for set "foo" for it.
This is true for many of the operator node, for example, to build a node with type of assign.  </p>
<div class="highlight"><pre><span></span><code><span class="c1">// C++</span>
<span class="k">auto</span> <span class="n">node_assign</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">();</span>   
<span class="k">auto</span> <span class="n">node_assign</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">(</span><span class="n">line_num</span><span class="p">);</span>     
<span class="k">auto</span> <span class="n">node_assign</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">(</span><span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>   
<span class="k">auto</span> <span class="n">node_assign</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">(</span><span class="n">token</span><span class="p">);</span> <span class="c1">// The token is not necessary to have a string_view  </span>
</code></pre></div>
<h1 id="module-input-output-and-register-declaration">Module Input, Output, and Register Declaration</h1>
<p>In LNAST, all input/output/register are defined in the node type reference
with differenct prefix of string_view, "$" stands for input, "%" stands for
output, and "#" stands for register. </p>
<h2 id="input">Input</h2>
<div class="highlight"><pre><span></span><code>// Pyrope
foo = $a
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="k">input</span> <span class="n">a</span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// C++</span>
<span class="k">auto</span> <span class="n">node_input</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span><span class="p">(</span><span class="s">&quot;$a&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>
</code></pre></div>
<h2 id="output">Output</h2>
<div class="highlight"><pre><span></span><code>// Pyrope
%out
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="k">output</span> <span class="n">out</span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// C++</span>
<span class="k">auto</span> <span class="n">node_output</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span><span class="p">(</span><span class="s">&quot;%out&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>
</code></pre></div>
<h2 id="register">Register</h2>
<div class="highlight"><pre><span></span><code>// Pyrope
reg_foo
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="kt">reg</span> <span class="n">reg_foo</span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// C++</span>
<span class="k">auto</span> <span class="n">node_reg</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span><span class="p">(</span><span class="s">&quot;#reg_foo&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>
</code></pre></div>
<h1 id="assign-statement">Assign Statement</h1>
<p>LNAST has 3 types of assignments. "=", "as", and ":=". </p>
<ul>
<li>The "lhs = rhs" assignment (assign), copies the rhs value to the lhs and makes sure
  that there is no bit drop. The lhs has to have equal or more bits than the
rhs.</li>
<li>The "lhs as rhs" assignment (as) is the same as the "=" assignment but it fixes
  the value. The lhs variable becomes a "C++ const" after the assignment. The
value assigned can not change again.</li>
<li>the "lhs := rhs" assignment (dp_assign) is like the "=" assignment but there is no check
  for overflow. If the rhs has more bits than the lhs, the upper bits will be
dropped.</li>
</ul>
<h2 id="assign-trivial-constant">Assign Trivial Constant</h2>
<div class="highlight"><pre><span></span><code>// Pyrope
val = 1023u10bits
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="k">assign</span> <span class="n">val</span> <span class="o">=</span> <span class="mh">10</span><span class="no">`d1023</span> <span class="c1">// val has 10 bits</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG
<span class="m">1</span>       <span class="m">0</span>       <span class="m">0</span>       SEQ0
<span class="m">2</span>       <span class="m">1</span>       <span class="m">0</span>       <span class="m">0</span>       <span class="nv">10</span>      <span class="o">=</span>       val     0d1023u10
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// C++</span>
<span class="k">auto</span> <span class="n">node_stmts</span>  <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span>  <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span> 
<span class="k">auto</span> <span class="n">node_assign</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span> <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span> 
<span class="k">auto</span> <span class="n">node_target</span> <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="s">&quot;val&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">node_const</span>  <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span>  <span class="p">(</span><span class="s">&quot;0d1023u10&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">idx_stmts</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_root</span><span class="p">,</span>   <span class="n">node_stmts</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts</span><span class="p">,</span>  <span class="n">node_assign</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">idx_target</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">node_target</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">idx_const</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">node_const</span><span class="p">);</span>
</code></pre></div>
<p><img alt="assign" src="../graphviz/assign_trivial_constant.png" />
An assign node sets the right hand side value to the reference pointed by the left hand side  <br />
of the expression. The left hand side is always a reference. The right hand side is a reference or a constant.   </p>
<h2 id="assign-simple-expression">Assign Simple Expression</h2>
<div class="highlight"><pre><span></span><code>// Pyrope
total := (x - 1) + 3 + 2
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="k">assign</span> <span class="n">total</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mh">1</span><span class="p">)</span> <span class="o">+</span> <span class="mh">3</span> <span class="o">+</span> <span class="mh">2</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG
<span class="m">1</span>       <span class="m">0</span>       <span class="m">0</span>       SEQ0
<span class="m">2</span>       <span class="m">1</span>       <span class="m">0</span>       <span class="m">0</span>       <span class="m">21</span>      -       ___a    x       0d1
<span class="m">3</span>       <span class="m">1</span>       <span class="m">1</span>       <span class="m">0</span>       <span class="m">21</span>      +       ___b    ___a    0d3    0d2
<span class="m">4</span>       <span class="m">1</span>       <span class="m">3</span>       <span class="m">0</span>       <span class="nv">21</span>      <span class="o">=</span>       total   ___b
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// C++</span>

<span class="c1">// preparing lnast_node data</span>
<span class="c1">// Note: as mentioned in the introduction, if you have the HDL-AST in hand, using</span>
<span class="c1">// Token directly instead of explicit string, line_num, pos ... etc.</span>

<span class="k">auto</span> <span class="n">node_stmts</span>  <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span>     <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span>  <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span> 
<span class="n">node</span> <span class="n">node_minus</span>  <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_minus</span>     <span class="p">(</span><span class="s">&quot;foo&quot;</span><span class="p">,</span>  <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>
<span class="n">node</span> <span class="n">node_lhs1</span>   <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>       <span class="p">(</span><span class="s">&quot;___a&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>
<span class="n">node</span> <span class="n">node_op1</span>    <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>       <span class="p">(</span><span class="s">&quot;x&quot;</span><span class="p">,</span>    <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>
<span class="n">node</span> <span class="n">node_op2</span>    <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span>     <span class="p">(</span><span class="s">&quot;0d1&quot;</span><span class="p">,</span>  <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>

<span class="n">node</span> <span class="n">node_plus</span>   <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_plus</span>      <span class="p">(</span><span class="s">&quot;bar&quot;</span><span class="p">,</span>  <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>
<span class="n">node</span> <span class="n">node_lhs2</span>   <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>       <span class="p">(</span><span class="s">&quot;___b&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>
<span class="n">node</span> <span class="n">node_op3</span>    <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>       <span class="p">(</span><span class="s">&quot;___a&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>
<span class="n">node</span> <span class="n">node_op4</span>    <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span>     <span class="p">(</span><span class="s">&quot;0d3&quot;</span><span class="p">,</span>  <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>
<span class="n">node</span> <span class="n">node_op5</span>    <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span>     <span class="p">(</span><span class="s">&quot;0d2&quot;</span><span class="p">,</span>  <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>

<span class="k">auto</span> <span class="n">node_dpa</span>    <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_dp_assign</span> <span class="p">(</span><span class="s">&quot;foo2&quot;</span><span class="p">,</span>  <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span> 
<span class="k">auto</span> <span class="n">node_lhs3</span>   <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>       <span class="p">(</span><span class="s">&quot;total&quot;</span><span class="p">,</span> <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">node_op6</span>    <span class="o">=</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>       <span class="p">(</span><span class="s">&quot;___b&quot;</span><span class="p">,</span>  <span class="n">line_num</span><span class="p">,</span> <span class="n">pos1</span><span class="p">,</span> <span class="n">pos2</span><span class="p">);</span>

<span class="c1">// construct the LNAST tree </span>
<span class="k">auto</span> <span class="n">idx_stmts</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_root</span><span class="p">,</span>  <span class="n">node_stmts</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">idx_minus</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts</span><span class="p">,</span> <span class="n">node_minus</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">idx_lhs1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_minus</span><span class="p">,</span> <span class="n">node_lhs1</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">idx_op1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_minus</span><span class="p">,</span> <span class="n">node_op1</span><span class="p">);</span>        
<span class="k">auto</span> <span class="n">idx_op2</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_minus</span><span class="p">,</span> <span class="n">node_op2</span><span class="p">);</span>        

<span class="k">auto</span> <span class="n">idx_plus</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts</span><span class="p">,</span> <span class="n">node_plus</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">idx_lhs2</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>  <span class="n">node_lhs2</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">idx_op3</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>  <span class="n">node_op3</span><span class="p">);</span>        
<span class="k">auto</span> <span class="n">idx_op4</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>  <span class="n">node_op4</span><span class="p">);</span>        
<span class="k">auto</span> <span class="n">idx_op5</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>  <span class="n">node_op5</span><span class="p">);</span>        

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts</span><span class="p">,</span>  <span class="n">node_dpa</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">idx_lhs3</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">node_lhs3</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">idx_op6</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">node_op6</span><span class="p">);</span>        
</code></pre></div>
<p><img alt="assign" src="../graphviz/assign_simple_expression.png" />
statements that have operations must breakdown the operations per type, and then assign the temporal value to the assign node.</p>
<h1 id="unary-operation-statement">Unary Operation Statement</h1>
<p>Unary operator is embedded as the prefix of the variable string_view</p>
<h2 id="binary-not-operation">Binary Not Operation</h2>
<div class="highlight"><pre><span></span><code>// Pyrope
%out = ~$inp
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="k">input</span>       <span class="n">inp</span><span class="p">;</span>
<span class="k">output</span> <span class="kt">wire</span> <span class="n">out</span><span class="p">;</span>

<span class="k">assign</span> <span class="n">out</span> <span class="o">=</span> <span class="o">~</span><span class="n">inp</span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="m">1</span> <span class="m">0</span> <span class="m">0</span> SEQ0
<span class="m">2</span> <span class="m">1</span> <span class="m">1</span> <span class="m">0</span>    <span class="m">10</span>  ~ %out  <span class="nv">$inp</span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="c1">//C++</span>
<span class="k">auto</span> <span class="n">idx_not</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_not</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_not</span><span class="p">(</span><span class="n">token1</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span><span class="p">(</span><span class="n">token2</span><span class="p">));</span> <span class="c1">// string_view = %out</span>
<span class="k">auto</span> <span class="n">idx_op</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span><span class="p">(</span><span class="n">token3</span><span class="p">));</span> <span class="c1">// string_view = $inp       </span>
</code></pre></div>
<img alt="assign" src="../graphviz/inv.png" /></p>
<h2 id="logical-not-operation">Logical Not Operation</h2>
<p>The not operation can be applied over logical values. Compares the input against zero to be true. The binary not
just toggles each bit.
<div class="highlight"><pre><span></span><code>// Pyrope
%out = !$inp
</code></pre></div></p>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="k">input</span>       <span class="n">inp</span><span class="p">;</span>
<span class="k">output</span> <span class="kt">wire</span> <span class="n">out</span><span class="p">;</span>

<span class="k">assign</span> <span class="n">out</span> <span class="o">=</span> <span class="o">!</span><span class="n">inp</span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="m">1</span> <span class="m">0</span> <span class="m">0</span> SEQ0
<span class="m">2</span> <span class="m">1</span> <span class="m">1</span> <span class="m">0</span>    <span class="m">10</span>  ! %out  <span class="nv">$inp</span>
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="c1">//C++</span>
<span class="k">auto</span> <span class="n">idx_not</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_logical_not</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_logical_not</span><span class="p">(</span><span class="n">token1</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span>     <span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>        <span class="p">(</span><span class="n">token2</span><span class="p">));</span> <span class="c1">// string_view = %out</span>
<span class="k">auto</span> <span class="n">idx_op</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span>     <span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>        <span class="p">(</span><span class="n">token3</span><span class="p">));</span> <span class="c1">// string_view = $inp       </span>
</code></pre></div>
<img alt="assign" src="../graphviz/logical_inv.png" /></p>
<h1 id="n-ary-operation-statement">N-ary Operation Statement</h1>
<p>N-ary operation computes n rhs operands and assign the result to the lhs.
The n-ary operator group includes</p>
<table>
<thead>
<tr>
<th align="center">Operator</th>
<th align="center">Syntax</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">And</td>
<td align="center">&amp;</td>
</tr>
<tr>
<td align="center">Or</td>
<td align="center">|</td>
</tr>
<tr>
<td align="center">Xor</td>
<td align="center">^</td>
</tr>
<tr>
<td align="center">Logical And</td>
<td align="center">and</td>
</tr>
<tr>
<td align="center">Logical Or</td>
<td align="center">or</td>
</tr>
<tr>
<td align="center">Plus</td>
<td align="center">+</td>
</tr>
<tr>
<td align="center">Minus</td>
<td align="center">-</td>
</tr>
<tr>
<td align="center">Multiply</td>
<td align="center">*</td>
</tr>
<tr>
<td align="center">Division</td>
<td align="center">/</td>
</tr>
<tr>
<td align="center">Equals to</td>
<td align="center">==</td>
</tr>
<tr>
<td align="center">Less than</td>
<td align="center">&lt;</td>
</tr>
<tr>
<td align="center">Less than or Equals to</td>
<td align="center">&lt;=</td>
</tr>
<tr>
<td align="center">Greater than</td>
<td align="center">&gt;</td>
</tr>
<tr>
<td align="center">Greater than or Equals to</td>
<td align="center">&gt;=</td>
</tr>
<tr>
<td align="center">Tuple concatenation</td>
<td align="center">++</td>
</tr>
</tbody>
</table>
<p>We take the "And Operator" for explaination.</p>
<h2 id="and-operation">And Operation</h2>
<div class="highlight"><pre><span></span><code>// Pyrope
out = a &amp; b &amp; c
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="k">assign</span> <span class="n">out</span> <span class="o">=</span> <span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span> <span class="o">&amp;</span> <span class="n">c</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG
<span class="m">1</span>       <span class="m">0</span>       <span class="m">0</span>       SEQ0
<span class="m">2</span>       <span class="m">1</span>       <span class="m">0</span>       <span class="m">0</span>       <span class="m">21</span>      <span class="p">&amp;</span>       ___a    a       b      c
<span class="m">3</span>       <span class="m">1</span>       <span class="m">3</span>       <span class="m">0</span>       <span class="nv">21</span>      <span class="o">=</span>       out     ___a
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="c1">// C++</span>
<span class="k">auto</span> <span class="n">idx_stmts</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_root</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span><span class="p">(</span><span class="n">token0</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_and</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_and</span>  <span class="p">(</span><span class="n">token1</span><span class="p">));</span> <span class="c1">// string_view = ___a</span>
<span class="k">auto</span> <span class="n">idx_lhs1</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_and</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>  <span class="p">(</span><span class="n">token2</span><span class="p">));</span> <span class="c1">// string_view = a</span>
<span class="k">auto</span> <span class="n">idx_op1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_and</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>  <span class="p">(</span><span class="n">token3</span><span class="p">));</span> <span class="c1">// string_view = b       </span>
<span class="k">auto</span> <span class="n">idx_op2</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_and</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>  <span class="p">(</span><span class="n">token4</span><span class="p">));</span> <span class="c1">// string_view = c       </span>

<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">(</span><span class="n">token5</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs2</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token6</span><span class="p">));</span> <span class="c1">// string_view = out</span>
<span class="k">auto</span> <span class="n">idx_op3</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token7</span><span class="p">));</span> <span class="c1">// string_view = ___a       </span>
</code></pre></div>
<img alt="assign" src="../graphviz/and.png" /></p>
<h1 id="if-statement">If Statement</h1>
<h2 id="simple-case">Simple Case</h2>
<div class="highlight"><pre><span></span><code>if a &gt; 3 {
  b = a + 1
} 
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG
<span class="m">1</span>  <span class="m">0</span>  <span class="m">0</span>  SEQ0                      
<span class="m">2</span>  <span class="m">1</span>  <span class="m">0</span>  <span class="m">0</span>     <span class="m">24</span>  <span class="k">if</span>  ___a        
<span class="m">3</span>  <span class="m">2</span>  <span class="m">0</span>  SEQ1                      
<span class="m">4</span>  <span class="m">3</span>  <span class="m">0</span>  <span class="m">0</span>     <span class="m">24</span>  &gt;   ___a  a     0d3
<span class="m">6</span>  <span class="m">2</span>  <span class="m">0</span>  SEQ2                      
<span class="m">7</span>  <span class="m">6</span>  <span class="m">0</span>  <span class="m">0</span>     <span class="m">24</span>  +   ___b  a     0d1
<span class="m">8</span>  <span class="m">6</span>  <span class="m">1</span>  <span class="m">0</span>     <span class="nv">24</span>  <span class="o">=</span>   a     ___b  
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">assign</span> <span class="n">b2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mh">3</span><span class="p">)</span> <span class="o">?</span> <span class="n">a</span> <span class="o">+</span> <span class="mh">1</span> <span class="o">:</span> <span class="n">b</span><span class="p">;</span> 
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">//C++ </span>

<span class="k">auto</span> <span class="n">idx_stmts0</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_root</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span> <span class="p">(</span><span class="n">token_0</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_if</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_if</span>    <span class="p">(</span><span class="n">token_1</span><span class="p">));</span> 

<span class="k">auto</span> <span class="n">idx_cstmts</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_if</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_cstmts</span><span class="p">(</span><span class="n">token_2</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_gt</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_cstmts</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_gt</span>    <span class="p">(</span><span class="n">token_3</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_gt</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_4</span><span class="p">));</span> <span class="c1">//string_view = &quot;___a&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_gt</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_5</span><span class="p">));</span> <span class="c1">//string_view = &quot;a&quot;</span>
<span class="k">auto</span> <span class="n">idx_op2</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_gt</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span> <span class="p">(</span><span class="n">token_6</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d3&quot;</span>

<span class="k">auto</span> <span class="n">idx_cond1</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_if</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_cond</span>  <span class="p">(</span><span class="n">token_7</span><span class="p">));</span> <span class="c1">//string_view = &quot;___a&quot;</span>

<span class="k">auto</span> <span class="n">idx_stmts1</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_if</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span> <span class="p">(</span><span class="n">token_8</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_plus</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_plus</span>  <span class="p">(</span><span class="n">token_9</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_a</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>
<span class="k">auto</span> <span class="n">idx_op3</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_b</span><span class="p">));</span> <span class="c1">//string_view = &quot;a&quot;</span>
<span class="k">auto</span> <span class="n">idx_op4</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span> <span class="p">(</span><span class="n">token_c</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d1&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">(</span><span class="n">token_d</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_e</span><span class="p">));</span> <span class="c1">//string_view = &quot;a&quot;</span>
<span class="k">auto</span> <span class="n">idx_op5</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_f</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>
</code></pre></div>
<p><img alt="assign" src="../graphviz/simple_if.png" />
An if-subtree consisted of conditional-statements sub-trees, boolean condition nodes, and statements 
sub-trees in the following order:</p>
<p>cstmts1 -&gt; condition1 -&gt; stmts1 -&gt; cstmts2 -&gt; condition2 -&gt; stmts2 ...-&gt; stmtsN, </p>
<p>If there is a final "else" chunk, it won't come with a corresponding conditionial
statements sub-tree and conditional node, see the figure for the detail.</p>
<h2 id="full-case">Full Case</h2>
<div class="highlight"><pre><span></span><code>// Pyrope
if a &gt; 10 {
  b = 3 
} elif a &lt; 1 {
  b = 2
} else {
  b = 1
}
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>

<span class="k">assign</span> <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">&gt;</span> <span class="mh">10</span><span class="p">)</span> <span class="o">?</span> <span class="mh">3</span> <span class="o">:</span>
           <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="mh">1</span> <span class="p">)</span> <span class="o">?</span> <span class="mh">2</span> <span class="o">:</span> <span class="mh">1</span> <span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG 
<span class="m">1</span>   <span class="m">0</span>   <span class="m">0</span>  SEQ0                       
<span class="m">2</span>   <span class="m">1</span>   <span class="m">0</span>  <span class="m">0</span>     <span class="m">62</span>  <span class="k">if</span>    ___a       
<span class="m">3</span>   <span class="m">2</span>   <span class="m">0</span>  SEQ1                       
<span class="m">4</span>   <span class="m">3</span>   <span class="m">0</span>  <span class="m">0</span>     <span class="m">62</span>  &gt;     ___a  a    0d10
<span class="m">6</span>   <span class="m">2</span>   <span class="m">0</span>  SEQ2                       
<span class="m">7</span>   <span class="m">6</span>   <span class="m">0</span>  <span class="m">0</span>     <span class="nv">62</span>  <span class="o">=</span>     b     0d3  
<span class="m">9</span>   <span class="m">2</span>   <span class="m">2</span>  <span class="m">0</span>     <span class="m">62</span>  <span class="k">elif</span>  ___b       
<span class="m">10</span>  <span class="m">2</span>   <span class="m">0</span>  SEQ3                       
<span class="m">11</span>  <span class="m">10</span>  <span class="m">0</span>  <span class="m">0</span>     <span class="m">62</span>  &lt;     ___b  a    0d1
<span class="m">13</span>  <span class="m">2</span>   <span class="m">0</span>  SEQ4                       
<span class="m">14</span>  <span class="m">13</span>  <span class="m">0</span>  <span class="m">0</span>     <span class="nv">62</span>  <span class="o">=</span>     b     0d2  
<span class="m">16</span>  <span class="m">2</span>   <span class="m">0</span>  SEQ5                       
<span class="m">17</span>  <span class="m">16</span>  <span class="m">0</span>  <span class="m">0</span>     <span class="nv">62</span>  <span class="o">=</span>     b     0d1  
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">//C++ </span>
<span class="k">auto</span> <span class="n">idx_stmts0</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_root</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span> <span class="p">(</span><span class="n">token_0</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_if</span>      <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_if</span>    <span class="p">(</span><span class="n">token_1</span><span class="p">));</span>

<span class="k">auto</span> <span class="n">idx_cstmts1</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_if</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_cstmts</span><span class="p">(</span><span class="n">token_2</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_gt</span>      <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_cstmts</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_gt</span>    <span class="p">(</span><span class="n">token_3</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_gt</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_4</span><span class="p">));</span> <span class="c1">//string_view = &quot;___a&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_gt</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_5</span><span class="p">));</span> <span class="c1">//string_view = &quot;a&quot;</span>
<span class="k">auto</span> <span class="n">idx_op2</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_gt</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span> <span class="p">(</span><span class="n">token_6</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d10&quot;</span>

<span class="k">auto</span> <span class="n">idx_cond1</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_if</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_cond</span>  <span class="p">(</span><span class="n">token_7</span><span class="p">));</span> <span class="c1">//string_view = &quot;___a&quot;</span>

<span class="k">auto</span> <span class="n">idx_stmts1</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_if</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span> <span class="p">(</span><span class="n">token_8</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">(</span><span class="n">token_9</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_a</span><span class="p">));</span> <span class="c1">//string_view = &quot;b&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span> <span class="p">(</span><span class="n">token_b</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d3&quot;</span>

<span class="k">auto</span> <span class="n">idx_cstmts2</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_if</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_cstmts</span><span class="p">(</span><span class="n">token_c</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lt</span>      <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_cstmts</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_lt</span>    <span class="p">(</span><span class="n">token_d</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_lt</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_e</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>
<span class="k">auto</span> <span class="n">idx_op2</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_lt</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_f</span><span class="p">));</span> <span class="c1">//string_view = &quot;a&quot;</span>
<span class="k">auto</span> <span class="n">idx_op3</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_lt</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span> <span class="p">(</span><span class="n">token_g</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d1&quot;</span>

<span class="k">auto</span> <span class="n">idx_cond2</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_if</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_cond</span>  <span class="p">(</span><span class="n">token_h</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>

<span class="k">auto</span> <span class="n">idx_stmts2</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_if</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span> <span class="p">(</span><span class="n">token_i</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts2</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">(</span><span class="n">token_j</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_k</span><span class="p">));</span> <span class="c1">//string_view = &quot;b&quot;</span>
<span class="k">auto</span> <span class="n">idx_op4</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span> <span class="p">(</span><span class="n">token_l</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d2&quot;</span>

<span class="k">auto</span> <span class="n">idx_stmts3</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_if</span><span class="p">,</span>     <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span> <span class="p">(</span><span class="n">token_m</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts3</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">(</span><span class="n">token_n</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token_o</span><span class="p">));</span> <span class="c1">//string_view = &quot;b&quot;</span>
<span class="k">auto</span> <span class="n">idx_op5</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span> <span class="p">(</span><span class="n">token_p</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d3&quot;</span>
</code></pre></div>
<p><img alt="assign" src="../graphviz/full_case_if.png" /></p>
<h1 id="tuple-statement">Tuple Statement</h1>
<p>The tuple LNAST node first entry always points to a "ref" node. This is the
destination of the tuple. The following entries point to LNAST nodes that can
be "assign", "as", "ref", or "const".</p>
<div class="highlight"><pre><span></span><code>// Pyrope
tup = (foo = 1, bar = cat + 2)
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="n">typede</span> <span class="k">packed</span> <span class="p">{</span>
  <span class="kt">logic</span>  <span class="n">foo</span><span class="p">;</span>
  <span class="kt">logic</span> <span class="p">[</span><span class="mh">4</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span>  <span class="n">bar</span><span class="p">;</span>
<span class="p">}</span> <span class="n">tup_t</span><span class="p">;</span>

<span class="n">tup_t</span> <span class="n">tup</span><span class="p">;</span>

<span class="k">always_comb</span> <span class="k">begin</span>
  <span class="n">tup</span><span class="p">.</span><span class="n">foo</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>
  <span class="n">tup</span><span class="p">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">cat</span> <span class="o">+</span> <span class="mh">2</span><span class="p">;</span>
<span class="k">end</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG 
// FIXME: SH: <span class="nb">wait</span> Akash to change tuple expression scope
<span class="m">1</span>       <span class="m">0</span>       x       SEQ0
<span class="m">4</span>       <span class="m">1</span>       x       <span class="m">0</span>       <span class="m">33</span>      +       ___d    cat     0d2
<span class="m">2</span>       <span class="m">1</span>       x       TUP0    ___a
<span class="m">3</span>       <span class="m">2</span>       x       <span class="m">0</span>       <span class="nv">33</span>      <span class="o">=</span>       foo     0d1
<span class="m">5</span>       <span class="m">2</span>       x       <span class="m">0</span>       <span class="nv">33</span>      <span class="o">=</span>       bar     ___d
<span class="m">7</span>       <span class="m">1</span>       x       <span class="m">0</span>       <span class="nv">33</span>      <span class="o">=</span>       tup     ___a
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">//C++ </span>
<span class="k">auto</span> <span class="n">idx_plus</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_plus</span>    <span class="p">(</span><span class="n">token_1</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_2</span><span class="p">));</span> <span class="c1">//string_view = &quot;___d&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_3</span><span class="p">));</span> <span class="c1">//string_view = &quot;cat&quot;</span>
<span class="k">auto</span> <span class="n">idx_op2</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span>   <span class="p">(</span><span class="n">token_4</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d2&quot;</span>

<span class="k">auto</span> <span class="n">idx_tup</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_tuple</span>   <span class="p">(</span><span class="n">token_5</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_tname</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_6</span><span class="p">));</span> <span class="c1">//string_view = &quot;tup&quot;</span>
<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>  <span class="p">(</span><span class="n">token_7</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_8</span><span class="p">));</span> <span class="c1">//string_view = &quot;foo&quot;</span>
<span class="k">auto</span> <span class="n">idx_op3</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span>   <span class="p">(</span><span class="n">token_9</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d1&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>  <span class="p">(</span><span class="n">token_a</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_b</span><span class="p">));</span> <span class="c1">//string_view = &quot;bar&quot;</span>
<span class="k">auto</span> <span class="n">idx_op4</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_c</span><span class="p">));</span> <span class="c1">//string_view = &quot;___d&quot;</span>
</code></pre></div>
<p><img alt="assign" src="../graphviz/tuple.png" /></p>
<h2 id="tuple-concatenation-statement">Tuple Concatenation Statement</h2>
<div class="highlight"><pre><span></span><code>// Pyrope
tup = (foo = 1, bar = cat + 2) 
tup = tup ++ (4, dog)
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG 
<span class="m">1</span>       <span class="m">0</span>       x       SEQ0
<span class="m">4</span>       <span class="m">1</span>       x       <span class="m">0</span>       <span class="m">33</span>      +       ___d    cat     0d2
<span class="m">2</span>       <span class="m">1</span>       x       TUP0    tup
<span class="m">3</span>       <span class="m">2</span>       x       <span class="m">0</span>       <span class="nv">33</span>      <span class="o">=</span>       foo     0d1
<span class="m">5</span>       <span class="m">2</span>       x       <span class="m">0</span>       <span class="nv">33</span>      <span class="o">=</span>       bar     ___d
<span class="m">7</span>       <span class="m">1</span>       x       TUP1    ___f
<span class="m">8</span>       <span class="m">7</span>       x       <span class="m">35</span>      <span class="nv">54</span>      <span class="o">=</span>       null    0d4
<span class="m">9</span>       <span class="m">7</span>       x       <span class="m">35</span>      <span class="nv">54</span>      <span class="o">=</span>       null    dog
<span class="m">10</span>      <span class="m">1</span>       x       <span class="m">35</span>      <span class="m">54</span>      ++      ___e    tup     ___f
<span class="m">11</span>      <span class="m">1</span>       x       <span class="m">35</span>      <span class="nv">54</span>      <span class="o">=</span>       tup     ___e
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="c1">//C++ </span>
<span class="k">auto</span> <span class="n">idx_plus</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_plus</span>    <span class="p">(</span><span class="n">token_1</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_2</span><span class="p">));</span> <span class="c1">//string_view = &quot;___d&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_3</span><span class="p">));</span> <span class="c1">//string_view = &quot;cat&quot;</span>
<span class="k">auto</span> <span class="n">idx_op2</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_plus</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span>   <span class="p">(</span><span class="n">token_4</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d2&quot;</span>

<span class="k">auto</span> <span class="n">idx_tup</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_tuple</span>   <span class="p">(</span><span class="n">token_5</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_tname</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_6</span><span class="p">));</span> <span class="c1">//string_view = &quot;tup&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>  <span class="p">(</span><span class="n">token_7</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_8</span><span class="p">));</span> <span class="c1">//string_view = &quot;foo&quot;</span>
<span class="k">auto</span> <span class="n">idx_op3</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span>   <span class="p">(</span><span class="n">token_9</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d1&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>  <span class="p">(</span><span class="n">token_a</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_b</span><span class="p">));</span> <span class="c1">//string_view = &quot;bar&quot;</span>
<span class="k">auto</span> <span class="n">idx_op4</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_c</span><span class="p">));</span> <span class="c1">//string_view = &quot;___d&quot;</span>


<span class="k">auto</span> <span class="n">idx_tup2</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_tuple</span>   <span class="p">(</span><span class="n">token_g</span><span class="p">))</span>
<span class="k">auto</span> <span class="n">idx_tname</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup2</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_h</span><span class="p">));</span> <span class="c1">//string_view = &quot;___f&quot;, for intermediate temp tuple</span>
<span class="k">auto</span> <span class="n">idx_op7</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup2</span>  <span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span>   <span class="p">(</span><span class="n">token_j</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d4&quot;</span>

<span class="k">auto</span> <span class="n">idx_op8</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup2</span>  <span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_reg</span>     <span class="p">(</span><span class="n">token_m</span><span class="p">));</span> <span class="c1">//string_view = &quot;dog&quot;</span>

<span class="k">auto</span> <span class="n">idx_tconcat</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_tuple_concat</span> <span class="p">(</span><span class="n">token_p</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tconcat</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_q</span><span class="p">));</span> <span class="c1">//string_view = &quot;___e&quot;</span>
<span class="k">auto</span> <span class="n">idx_op9</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tconcat</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_r</span><span class="p">));</span> <span class="c1">//string_view = &quot;tup&quot;</span>
<span class="k">auto</span> <span class="n">idx_opa</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tconcat</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_s</span><span class="p">));</span> <span class="c1">//string_view = &quot;___f&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>  <span class="p">(</span><span class="n">token_t</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_u</span><span class="p">));</span> <span class="c1">//string_view = &quot;tup&quot;</span>
<span class="k">auto</span> <span class="n">idx_opb</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_v</span><span class="p">));</span> <span class="c1">//string_view = &quot;___e&quot;</span>
</code></pre></div>
<img alt="assign" src="../graphviz/tuple_concat.png" /></p>
<h1 id="for-loop-statement">For Loop Statement</h1>
<div class="highlight"><pre><span></span><code>// Pyrope
for i in (0..3) {
  tuple_foo[i] = tuple_bar[3-i]
}
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG 
// FIXME: SH: still need to check with new CFG from Akash
<span class="m">1</span>       <span class="m">0</span>       x       SEQ0
<span class="m">2</span>       <span class="m">1</span>       <span class="m">0</span>       TUP0    ___b
<span class="m">3</span>       <span class="m">2</span>       <span class="m">0</span>       <span class="m">0</span>       <span class="m">51</span>      ..      ___c    0d0     0d3
<span class="m">5</span>       <span class="m">1</span>       <span class="m">2</span>       <span class="m">0</span>       <span class="m">51</span>      <span class="k">for</span>     i       ___b
<span class="m">7</span>       <span class="m">5</span>       <span class="m">0</span>       SEQ1
<span class="m">8</span>       <span class="m">7</span>       <span class="m">0</span>       <span class="m">0</span>       <span class="m">51</span>      <span class="o">[]</span>      ___d    tuple_foo       i
<span class="m">9</span>       <span class="m">7</span>       <span class="m">1</span>       <span class="m">0</span>       <span class="m">51</span>      -       ___g    0d3     i
<span class="m">10</span>      <span class="m">7</span>       <span class="m">2</span>       <span class="m">0</span>       <span class="m">51</span>      <span class="o">[]</span>      ___f    tuple_bar       ___g
<span class="m">11</span>      <span class="m">7</span>       <span class="m">3</span>       <span class="m">0</span>       <span class="m">51</span>      .<span class="o">()</span>     ___e    ___f
<span class="m">12</span>      <span class="m">7</span>       <span class="m">4</span>       <span class="m">0</span>       <span class="nv">51</span>      <span class="o">=</span>       ___d    ___e
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="c1">//C++ </span>

<span class="k">auto</span> <span class="n">idx_tup</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_tuple</span>  <span class="p">(</span><span class="n">token_1</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_tname</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_2</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span> <span class="p">(</span><span class="n">token_3</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_4</span><span class="p">));</span> <span class="c1">//string_view = &quot;__range_begin&quot;</span>
<span class="k">auto</span> <span class="n">idx_op3</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span>  <span class="p">(</span><span class="n">token_5</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d0&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span> <span class="p">(</span><span class="n">token_6</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_7</span><span class="p">));</span> <span class="c1">//string_view = &quot;__range_end&quot;</span>
<span class="k">auto</span> <span class="n">idx_op3</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span>  <span class="p">(</span><span class="n">token_8</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d3&quot;</span>

<span class="k">auto</span> <span class="n">idx_for</span>       <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_for</span>  <span class="p">(</span><span class="n">token_9</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_stmts1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_for</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span><span class="p">(</span><span class="n">token_a</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_itr</span>       <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_for</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>  <span class="p">(</span><span class="n">token_b</span><span class="p">));</span> <span class="c1">//string_view = &quot;i&quot;</span>
<span class="k">auto</span> <span class="n">idx_itr_range</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_for</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>  <span class="p">(</span><span class="n">token_c</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>

<span class="k">auto</span> <span class="n">idx_select</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_select</span> <span class="p">(</span><span class="n">token_d</span><span class="p">));</span>  
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_select</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_e</span><span class="p">));</span> <span class="c1">//string_view = &quot;___d&quot;</span>
<span class="k">auto</span> <span class="n">idx_op4</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_select</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_f</span><span class="p">));</span> <span class="c1">//string_view = &quot;tup_foo&quot;</span>
<span class="k">auto</span> <span class="n">idx_op5</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_select</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_g</span><span class="p">));</span> <span class="c1">//string_view = &quot;i&quot;</span>

<span class="k">auto</span> <span class="n">idx_minus</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_minus</span>  <span class="p">(</span><span class="n">token_h</span><span class="p">));</span>  
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_minus</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_i</span><span class="p">));</span> <span class="c1">//string_view = &quot;___g&quot;</span>
<span class="k">auto</span> <span class="n">idx_op6</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_minus</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_cond</span>   <span class="p">(</span><span class="n">token_j</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d3&quot;</span>
<span class="k">auto</span> <span class="n">idx_op7</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_minus</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_k</span><span class="p">));</span> <span class="c1">//string_view = &quot;i&quot;</span>

<span class="k">auto</span> <span class="n">idx_select</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_select</span> <span class="p">(</span><span class="n">token_l</span><span class="p">));</span>  
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_select</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_m</span><span class="p">));</span> <span class="c1">//string_view = &quot;___f&quot;</span>
<span class="k">auto</span> <span class="n">idx_op8</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_select</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_n</span><span class="p">));</span> <span class="c1">//string_view = &quot;tup_bar&quot;</span>
<span class="k">auto</span> <span class="n">idx_op9</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_select</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_o</span><span class="p">));</span> <span class="c1">//string_view = &quot;___g&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span> <span class="p">(</span><span class="n">token_p</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_q</span><span class="p">));</span> <span class="c1">//string_view = &quot;___d&quot;</span>
<span class="k">auto</span> <span class="n">idx_opa</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token_r</span><span class="p">));</span> <span class="c1">//string_view = &quot;___f&quot;</span>
</code></pre></div>
<img alt="assign" src="../graphviz/for.png" /></p>
<h1 id="while-loop-statement">While Loop Statement</h1>
<div class="highlight"><pre><span></span><code>// Pyrope
for i in (0..3) {
  tup_foo[i] = tup_bar[3-i]
}
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG 
<span class="m">1</span>       <span class="m">0</span>       <span class="m">0</span>       SEQ0
<span class="m">2</span>       <span class="m">1</span>       <span class="m">0</span>       <span class="m">0</span>       <span class="m">58</span>      &gt;       ___a    i       0d0
<span class="m">3</span>       <span class="m">1</span>       <span class="m">1</span>       <span class="m">0</span>       <span class="m">58</span>      <span class="k">while</span>   ___a
<span class="m">5</span>       <span class="m">3</span>       <span class="m">0</span>       SEQ1
<span class="m">6</span>       <span class="m">5</span>       <span class="m">0</span>       <span class="m">0</span>       <span class="m">58</span>      <span class="o">[]</span>      ___b    tup_foo i
<span class="m">7</span>       <span class="m">5</span>       <span class="m">1</span>       <span class="m">0</span>       <span class="m">58</span>      -       ___e    0d3     i
<span class="m">8</span>       <span class="m">5</span>       <span class="m">2</span>       <span class="m">0</span>       <span class="m">58</span>      <span class="o">[]</span>      ___d    tup_bar ___e
<span class="m">9</span>       <span class="m">5</span>       <span class="m">4</span>       <span class="m">0</span>       <span class="nv">58</span>      <span class="o">=</span>       ___b    ___d
<span class="m">10</span>      <span class="m">5</span>       <span class="m">5</span>       <span class="m">0</span>       <span class="m">58</span>      -       ___f    i       0d1
<span class="m">11</span>      <span class="m">5</span>       <span class="m">6</span>       <span class="m">0</span>       <span class="nv">58</span>      <span class="o">=</span>       i       ___f
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="c1">//C++ </span>
<span class="k">auto</span> <span class="n">idx_while</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_while</span>   <span class="p">(</span><span class="n">token_0</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_cond</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_while</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_cond</span>    <span class="p">(</span><span class="n">token_1</span><span class="p">));</span> <span class="c1">//string_view = &quot;___a&quot;</span>
<span class="k">auto</span> <span class="n">idx_stmts1</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_while</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span>   <span class="p">(</span><span class="n">token_2</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_exp1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_select</span>  <span class="p">(</span><span class="n">token_3</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>
<span class="p">.</span>
<span class="p">.</span>
<span class="p">.</span>
</code></pre></div>
<img alt="assign" src="../graphviz/while.png" /></p>
<h1 id="function-definition-statement">Function Definition Statement</h1>
<h2 id="basic-function-definition">Basic Function Definition</h2>
<p>A function could be viewed as a module, the arguments of a function represent
the module IO with the io-prefix, $ for input or % for output. </p>
<p>In LNAST, a function definition statement is composed as the following node sequence:</p>
<p>function_name -&gt; condition -&gt; statements(function body) -&gt; io_1 -&gt; io_2 -&gt; io_N ...</p>
<div class="highlight"><pre><span></span><code>// Pyrope
func_xor = :($a, $b, %out):{
  %out = $a ^ $b
}
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="k">module</span> <span class="n">func_xor</span><span class="p">(</span>
  <span class="k">input</span> <span class="n">a</span><span class="p">,</span>
  <span class="k">input</span> <span class="n">b</span><span class="p">,</span>
  <span class="n">outpout</span> <span class="kt">wire</span> <span class="n">out</span>
<span class="p">);</span>

  <span class="k">assign</span> <span class="n">out</span> <span class="o">=</span> <span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">;</span>

<span class="k">endmodule</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG 
<span class="m">1</span>  <span class="m">0</span>  <span class="m">0</span>  SEQ0                                    
<span class="m">2</span>  <span class="m">1</span>  <span class="m">0</span>  <span class="m">0</span>     <span class="m">47</span>  ::<span class="o">{</span>  ___a null <span class="nv">$a</span>  <span class="nv">$b</span>  %out
<span class="m">4</span>  <span class="m">2</span>  <span class="m">0</span>  SEQ1                                    
<span class="m">5</span>  <span class="m">4</span>  <span class="m">0</span>  <span class="m">0</span>     <span class="m">47</span>  ^    ___b      <span class="nv">$a</span>     <span class="nv">$b</span>      
<span class="m">6</span>  <span class="m">4</span>  <span class="m">1</span>  <span class="m">0</span>     <span class="nv">47</span>  <span class="o">=</span>    %out      ___b           
<span class="m">7</span>  <span class="m">1</span>  <span class="m">1</span>  <span class="m">0</span>     <span class="nv">47</span>  <span class="o">=</span>    func_xor  <span class="se">\_</span>__a          
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="c1">//C++ </span>
<span class="k">auto</span> <span class="n">idx_stmts0</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_root</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span>   <span class="p">(</span><span class="n">token_0</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_func</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_func_def</span><span class="p">(</span><span class="n">token_1</span><span class="p">));</span>

<span class="k">auto</span> <span class="n">idx_fname</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_2</span><span class="p">));</span> <span class="c1">//string_view = &quot;func_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_cond</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_cond</span>    <span class="p">(</span><span class="n">token_3</span><span class="p">));</span> <span class="c1">//string_view = &quot;true&quot;</span>
<span class="k">auto</span> <span class="n">idx_stmts1</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span>   <span class="p">(</span><span class="n">token_4</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_io1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_5</span><span class="p">));</span> <span class="c1">//string_view = &quot;$a&quot;</span>
<span class="k">auto</span> <span class="n">idx_io2</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_6</span><span class="p">));</span> <span class="c1">//string_view = &quot;$b&quot;</span>
<span class="k">auto</span> <span class="n">idx_io3</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_7</span><span class="p">));</span> <span class="c1">//string_view = &quot;$out&quot;</span>

<span class="k">auto</span> <span class="n">idx_xor</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_xor</span>     <span class="p">(</span><span class="n">token_7</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_xor</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_8</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_xor</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_9</span><span class="p">));</span> <span class="c1">//string_view = &quot;$a&quot;</span>
<span class="k">auto</span> <span class="n">idx_op2</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_xor</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_a</span><span class="p">));</span> <span class="c1">//string_view = &quot;$b&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>  <span class="p">(</span><span class="n">token_b</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_c</span><span class="p">));</span> <span class="c1">//string_view = &quot;%out&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_d</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>
</code></pre></div>
<img alt="assign" src="../graphviz/function_def.png" /></p>
<h2 id="conditional-function-definition">Conditional Function Definition</h2>
<p>If the HDL support the conditional function definition, for example, Pyrope, we
have to assign the appropriate condition variable to the condition node. In the
example of the following Pyrope code, the func_xor function will only be
declared when its intput $valid is true. For normal case, we assign "true"
string_view to this condition node. See figure for better understanding.</p>
<div class="highlight"><pre><span></span><code>// Pyrope
func_xor = :($a, $b, $valid, %out) when $valid:{
  %out = $a ^ $b
}
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="k">module</span> <span class="n">func_xor</span><span class="p">(</span>
  <span class="k">input</span> <span class="n">a</span><span class="p">,</span>
  <span class="k">input</span> <span class="n">b</span><span class="p">,</span>
  <span class="n">outpout</span> <span class="kt">wire</span> <span class="n">out</span>
<span class="p">);</span>

  <span class="k">assign</span> <span class="n">out</span> <span class="o">=</span> <span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">;</span>

<span class="k">endmodule</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG 
<span class="m">1</span>  <span class="m">0</span>  <span class="m">0</span>  SEQ0                                    
<span class="m">2</span>  <span class="m">1</span>  <span class="m">0</span>  <span class="m">0</span>     <span class="m">47</span>  ::<span class="o">{</span>  ___a      <span class="nv">$valid</span>  <span class="nv">$a</span>  <span class="nv">$b</span>  <span class="nv">$valid</span> %out
<span class="m">4</span>  <span class="m">2</span>  <span class="m">0</span>  SEQ1                                    
<span class="m">5</span>  <span class="m">4</span>  <span class="m">0</span>  <span class="m">0</span>     <span class="m">47</span>  ^    ___b      <span class="nv">$a</span>     <span class="nv">$b</span>      
<span class="m">6</span>  <span class="m">4</span>  <span class="m">1</span>  <span class="m">0</span>     <span class="nv">47</span>  <span class="o">=</span>    %out      ___b           
<span class="m">7</span>  <span class="m">1</span>  <span class="m">1</span>  <span class="m">0</span>     <span class="nv">47</span>  <span class="o">=</span>    func_xor  <span class="se">\_</span>__a          
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">//C++ </span>
<span class="k">auto</span> <span class="n">idx_stmts0</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_root</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span>   <span class="p">(</span><span class="n">token_0</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_func</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_func_def</span><span class="p">(</span><span class="n">token_1</span><span class="p">));</span>

<span class="k">auto</span> <span class="n">idx_fname</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_2</span><span class="p">));</span> <span class="c1">//string_view = &quot;func_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_cond</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_cond</span>    <span class="p">(</span><span class="n">token_3</span><span class="p">));</span> <span class="c1">//string_view = &quot;$valid&quot;</span>
<span class="k">auto</span> <span class="n">idx_stmts1</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span>   <span class="p">(</span><span class="n">token_4</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_io1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_5</span><span class="p">));</span> <span class="c1">//string_view = &quot;$a&quot;</span>
<span class="k">auto</span> <span class="n">idx_io2</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_6</span><span class="p">));</span> <span class="c1">//string_view = &quot;$b&quot;</span>
<span class="k">auto</span> <span class="n">idx_io3</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_7</span><span class="p">));</span> <span class="c1">//string_view = &quot;$out&quot;</span>

<span class="k">auto</span> <span class="n">idx_xor</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_xor</span>     <span class="p">(</span><span class="n">token_7</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_xor</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_8</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_xor</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_9</span><span class="p">));</span> <span class="c1">//string_view = &quot;$a&quot;</span>
<span class="k">auto</span> <span class="n">idx_op2</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_xor</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_a</span><span class="p">));</span> <span class="c1">//string_view = &quot;$b&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>  <span class="p">(</span><span class="n">token_b</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_c</span><span class="p">));</span> <span class="c1">//string_view = &quot;%out&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_d</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>  <span class="p">(</span><span class="n">token_e</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_f</span><span class="p">));</span> <span class="c1">//string_view = &quot;func_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_g</span><span class="p">));</span> <span class="c1">//string_view = &quot;\___a&quot;</span>
</code></pre></div>
<p><img alt="assign" src="../graphviz/function_def_conditional.png" /></p>
<h1 id="function-call">Function Call</h1>
<h2 id="implicit-function-argument-assignment">Implicit Function Argument Assignment</h2>
<div class="highlight"><pre><span></span><code>// Pyrope
func_xor = :($a, $b, %out):{
  %out = $a ^ $b
}

my_xor = func_xor($foo, $bar)
%out = my_xor.out
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="k">module</span> <span class="n">func_xor</span><span class="p">(</span>
  <span class="k">input</span> <span class="n">a</span><span class="p">,</span>
  <span class="k">input</span> <span class="n">b</span><span class="p">,</span>
  <span class="n">outpout</span> <span class="kt">wire</span> <span class="n">out</span>
<span class="p">);</span>

  <span class="k">assign</span> <span class="n">out</span> <span class="o">=</span> <span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">;</span>

<span class="k">endmodule</span>

<span class="k">module</span> <span class="n">top</span><span class="p">(</span>
  <span class="k">input</span> <span class="n">foo</span><span class="p">,</span>
  <span class="k">input</span> <span class="n">bar</span><span class="p">,</span>
  <span class="k">output</span> <span class="kt">wire</span> <span class="n">out</span>
<span class="p">);</span>

  <span class="n">func_xor</span> <span class="n">my_xor</span><span class="p">(.</span><span class="n">a</span><span class="p">(</span><span class="n">foo</span><span class="p">),</span> <span class="p">.</span><span class="n">b</span><span class="p">(</span><span class="n">bar</span><span class="p">),</span> <span class="p">.</span><span class="n">out</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>

<span class="k">endmodule</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG 
<span class="m">1</span>   <span class="m">0</span>  <span class="m">0</span>  SEQ0                                            
<span class="m">2</span>   <span class="m">1</span>  <span class="m">0</span>  <span class="m">0</span>     <span class="m">47</span>    ::<span class="o">{</span>   ___a      null      <span class="nv">$a</span>    <span class="nv">$b</span>  %out
<span class="m">4</span>   <span class="m">2</span>  <span class="m">0</span>  SEQ1                                            
<span class="m">5</span>   <span class="m">4</span>  <span class="m">0</span>  <span class="m">0</span>     <span class="m">47</span>    ^     ___b      <span class="nv">$a</span>        <span class="nv">$b</span>        
<span class="m">6</span>   <span class="m">4</span>  <span class="m">1</span>  <span class="m">0</span>     <span class="nv">47</span>    <span class="o">=</span>     %out      ___b                
<span class="m">7</span>   <span class="m">1</span>  <span class="m">1</span>  <span class="m">0</span>     <span class="nv">47</span>    <span class="o">=</span>     func_xor  <span class="se">\_</span>__a               
<span class="m">8</span>   <span class="m">1</span>  <span class="m">0</span>  TUP0  ___d                                      
<span class="m">9</span>   <span class="m">8</span>  <span class="m">2</span>  <span class="nv">49</span>    <span class="o">=</span>     null  <span class="nv">$foo</span>                          
<span class="m">10</span>  <span class="m">8</span>  <span class="m">3</span>  <span class="nv">49</span>    <span class="o">=</span>     null  <span class="nv">$bar</span>                          
<span class="m">11</span>  <span class="m">1</span>  <span class="m">4</span>  <span class="m">49</span>    <span class="m">78</span>    .<span class="o">()</span>   my_xor    func_xor  ___d      
<span class="m">13</span>  <span class="m">1</span>  <span class="m">6</span>  <span class="m">79</span>    <span class="m">96</span>    .     ___f      my_xor    out       
<span class="m">15</span>  <span class="m">1</span>  <span class="m">8</span>  <span class="m">79</span>    <span class="nv">96</span>    <span class="o">=</span>     %out      ___f                
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">//C++ </span>
<span class="k">auto</span> <span class="n">idx_stmts0</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_root</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span>   <span class="p">(</span><span class="n">token_0</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_func</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_func_def</span><span class="p">(</span><span class="n">token_1</span><span class="p">));</span>

<span class="k">auto</span> <span class="n">idx_fname</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_2</span><span class="p">));</span> <span class="c1">//string_view = &quot;func_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_cond</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_cond</span>    <span class="p">(</span><span class="n">token_3</span><span class="p">));</span> <span class="c1">//string_view = &quot;true&quot;</span>
<span class="k">auto</span> <span class="n">idx_stmts1</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span>   <span class="p">(</span><span class="n">token_4</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_io1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_5</span><span class="p">));</span> <span class="c1">//string_view = &quot;$a&quot;</span>
<span class="k">auto</span> <span class="n">idx_io2</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_6</span><span class="p">));</span> <span class="c1">//string_view = &quot;$b&quot;</span>
<span class="k">auto</span> <span class="n">idx_io3</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_7</span><span class="p">));</span> <span class="c1">//string_view = &quot;$out&quot;</span>

<span class="k">auto</span> <span class="n">idx_xor</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_xor</span>     <span class="p">(</span><span class="n">token_8</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_xor</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_9</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_xor</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_a</span><span class="p">));</span> <span class="c1">//string_view = &quot;$a&quot;</span>
<span class="k">auto</span> <span class="n">idx_op2</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_xor</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_b</span><span class="p">));</span> <span class="c1">//string_view = &quot;$b&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>  <span class="p">(</span><span class="n">token_c</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_d</span><span class="p">));</span> <span class="c1">//string_view = &quot;%out&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_e</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>  <span class="p">(</span><span class="n">token_f</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_g</span><span class="p">));</span> <span class="c1">//string_view = &quot;func_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_h</span><span class="p">));</span> <span class="c1">//string_view = &quot;\___a&quot;</span>

<span class="k">auto</span> <span class="n">idx_tup</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_tuple</span>    <span class="p">(</span><span class="n">token_i</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_tname</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_j</span><span class="p">));</span> <span class="c1">//string_view = &quot;___d&quot;</span>
<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>   <span class="p">(</span><span class="n">token_k</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_l</span><span class="p">));</span> <span class="c1">//string_view = &quot;null&quot;</span>
<span class="k">auto</span> <span class="n">idx_op3</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_m</span><span class="p">));</span> <span class="c1">//string_view = &quot;$foo&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>   <span class="p">(</span><span class="n">token_n</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_o</span><span class="p">));</span> <span class="c1">//string_view = &quot;null&quot;</span>
<span class="k">auto</span> <span class="n">idx_op3</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_p</span><span class="p">));</span> <span class="c1">//string_view = &quot;$bar&quot;</span>

<span class="k">auto</span> <span class="n">idx_fcall</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_func_call</span><span class="p">(</span><span class="n">token_q</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_fcall</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_r</span><span class="p">));</span> <span class="c1">//string_view = &quot;my_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_target</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_fcall</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_s</span><span class="p">));</span> <span class="c1">//string_view = &quot;func_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_arg</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_fcall</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_t</span><span class="p">));</span> <span class="c1">//string_view = &quot;___d&quot;</span>

<span class="k">auto</span> <span class="n">idx_dot</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_dot</span>      <span class="p">(</span><span class="n">token_u</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_dot</span>   <span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_v</span><span class="p">));</span> <span class="c1">//string_view = &quot;___f&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_dot</span>   <span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_w</span><span class="p">));</span> <span class="c1">//string_view = &quot;my_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_op2</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_dot</span>   <span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_x</span><span class="p">));</span> <span class="c1">//string_view = &quot;out&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>   <span class="p">(</span><span class="n">token_y</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_z</span><span class="p">));</span> <span class="c1">//string_view = &quot;%out&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_aa</span><span class="p">));</span><span class="c1">//string_view = &quot;___f&quot;</span>
</code></pre></div>
<p><img alt="assign" src="../graphviz/function_call_imp.png" /></p>
<h2 id="explicit-function-argument-assignment">Explicit Function Argument Assignment</h2>
<div class="highlight"><pre><span></span><code>// Pyrope
func_xor = :($a, $b, %out):{
  %out = $a ^ $b
}

my_xor = func_xor(a = $foo, b = $bar)
%out = my_xor.out
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="k">module</span> <span class="n">func_xor</span><span class="p">(</span>
  <span class="k">input</span> <span class="n">a</span><span class="p">,</span>
  <span class="k">input</span> <span class="n">b</span><span class="p">,</span>
  <span class="n">outpout</span> <span class="kt">wire</span> <span class="n">out</span>
<span class="p">);</span>

  <span class="k">assign</span> <span class="n">out</span> <span class="o">=</span> <span class="n">a</span> <span class="o">^</span> <span class="n">b</span><span class="p">;</span>

<span class="k">endmodule</span>

<span class="k">module</span> <span class="n">top</span><span class="p">(</span>
  <span class="k">input</span> <span class="n">foo</span><span class="p">,</span>
  <span class="k">input</span> <span class="n">bar</span><span class="p">,</span>
  <span class="k">output</span> <span class="kt">wire</span> <span class="n">out</span>
<span class="p">);</span>

  <span class="n">func_xor</span> <span class="n">my_xor</span><span class="p">(.</span><span class="n">a</span><span class="p">(</span><span class="n">foo</span><span class="p">),</span> <span class="p">.</span><span class="n">b</span><span class="p">(</span><span class="n">bar</span><span class="p">),</span> <span class="p">.</span><span class="n">out</span><span class="p">(</span><span class="n">out</span><span class="p">))</span>

<span class="k">endmodule</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG 
<span class="m">1</span>   <span class="m">0</span>  <span class="m">0</span>   SEQ0                                           
<span class="m">2</span>   <span class="m">1</span>  <span class="m">0</span>   <span class="m">0</span>     <span class="m">47</span>    ::<span class="o">{</span>  ___a      null      <span class="nv">$a</span>    <span class="nv">$b</span>  %out
<span class="m">4</span>   <span class="m">2</span>  <span class="m">0</span>   SEQ1                                           
<span class="m">5</span>   <span class="m">4</span>  <span class="m">0</span>   <span class="m">0</span>     <span class="m">47</span>    ^    ___b      <span class="nv">$a</span>        <span class="nv">$b</span>        
<span class="m">6</span>   <span class="m">4</span>  <span class="m">1</span>   <span class="m">0</span>     <span class="nv">47</span>    <span class="o">=</span>    %out      ___b                
<span class="m">7</span>   <span class="m">1</span>  <span class="m">1</span>   <span class="m">0</span>     <span class="nv">47</span>    <span class="o">=</span>    func_xor  <span class="se">\_</span>__a               
<span class="m">8</span>   <span class="m">1</span>  <span class="m">0</span>   TUP0  ___d                                     
<span class="m">10</span>  <span class="m">8</span>  <span class="m">3</span>   <span class="m">49</span>    <span class="nv">86</span>    <span class="o">=</span>    a         <span class="nv">$foo</span>                
<span class="m">12</span>  <span class="m">8</span>  <span class="m">5</span>   <span class="m">49</span>    <span class="nv">86</span>    <span class="o">=</span>    b         <span class="nv">$bar</span>                
<span class="m">13</span>  <span class="m">1</span>  <span class="m">6</span>   <span class="m">49</span>    <span class="m">86</span>    .<span class="o">()</span>  ___c      func_xor  ___d      
<span class="m">14</span>  <span class="m">1</span>  <span class="m">7</span>   <span class="m">49</span>    <span class="nv">86</span>    <span class="o">=</span>    my_xor    ___c                
<span class="m">15</span>  <span class="m">1</span>  <span class="m">8</span>   <span class="m">87</span>    <span class="m">104</span>   .    ___j      my_xor    out       
<span class="m">17</span>  <span class="m">1</span>  <span class="m">10</span>  <span class="m">87</span>    <span class="nv">104</span>   <span class="o">=</span>    %out      ___j                
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="c1">//C++ </span>
<span class="k">auto</span> <span class="n">idx_stmts0</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_root</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span>   <span class="p">(</span><span class="n">token_0</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_func</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_func_def</span><span class="p">(</span><span class="n">token_1</span><span class="p">));</span>

<span class="k">auto</span> <span class="n">idx_fname</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_2</span><span class="p">));</span> <span class="c1">//string_view = &quot;func_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_cond</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_cond</span>    <span class="p">(</span><span class="n">token_3</span><span class="p">));</span> <span class="c1">//string_view = &quot;true&quot;</span>
<span class="k">auto</span> <span class="n">idx_stmts1</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_stmts</span>   <span class="p">(</span><span class="n">token_4</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_io1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_5</span><span class="p">));</span> <span class="c1">//string_view = &quot;$a&quot;</span>
<span class="k">auto</span> <span class="n">idx_io2</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_6</span><span class="p">));</span> <span class="c1">//string_view = &quot;$b&quot;</span>
<span class="k">auto</span> <span class="n">idx_io3</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_func</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_7</span><span class="p">));</span> <span class="c1">//string_view = &quot;$out&quot;</span>

<span class="k">auto</span> <span class="n">idx_xor</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_xor</span>     <span class="p">(</span><span class="n">token_8</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_xor</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_9</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_xor</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_a</span><span class="p">));</span> <span class="c1">//string_view = &quot;$a&quot;</span>
<span class="k">auto</span> <span class="n">idx_op2</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_xor</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_b</span><span class="p">));</span> <span class="c1">//string_view = &quot;$b&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts1</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>  <span class="p">(</span><span class="n">token_c</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_d</span><span class="p">));</span> <span class="c1">//string_view = &quot;%out&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_e</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>  <span class="p">(</span><span class="n">token_f</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_g</span><span class="p">));</span> <span class="c1">//string_view = &quot;func_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>     <span class="p">(</span><span class="n">token_h</span><span class="p">));</span> <span class="c1">//string_view = &quot;\___a&quot;</span>

<span class="k">auto</span> <span class="n">idx_tup</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_tuple</span>    <span class="p">(</span><span class="n">token_i</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_tname</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_j</span><span class="p">));</span> <span class="c1">//string_view = &quot;___d&quot;</span>
<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>   <span class="p">(</span><span class="n">token_k</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_l</span><span class="p">));</span> <span class="c1">//string_view = &quot;a&quot;</span>
<span class="k">auto</span> <span class="n">idx_op3</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_m</span><span class="p">));</span> <span class="c1">//string_view = &quot;$foo&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>   <span class="p">(</span><span class="n">token_n</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_o</span><span class="p">));</span> <span class="c1">//string_view = &quot;b&quot;</span>
<span class="k">auto</span> <span class="n">idx_op3</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_p</span><span class="p">));</span> <span class="c1">//string_view = &quot;$bar&quot;</span>

<span class="k">auto</span> <span class="n">idx_fcall</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_func_call</span><span class="p">(</span><span class="n">token_q</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_fcall</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_r</span><span class="p">));</span> <span class="c1">//string_view = &quot;my_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_target</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_fcall</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_s</span><span class="p">));</span> <span class="c1">//string_view = &quot;func_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_arg</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_fcall</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_t</span><span class="p">));</span> <span class="c1">//string_view = &quot;___d&quot;</span>

<span class="k">auto</span> <span class="n">idx_dot</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_dot</span>      <span class="p">(</span><span class="n">token_u</span><span class="p">));</span> 
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_dot</span>   <span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_v</span><span class="p">));</span> <span class="c1">//string_view = &quot;___j&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_dot</span>   <span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_w</span><span class="p">));</span> <span class="c1">//string_view = &quot;my_xor&quot;</span>
<span class="k">auto</span> <span class="n">idx_op2</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_dot</span>   <span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_x</span><span class="p">));</span> <span class="c1">//string_view = &quot;out&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts0</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span>   <span class="p">(</span><span class="n">token_y</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_z</span><span class="p">));</span> <span class="c1">//string_view = &quot;%out&quot;</span>
<span class="k">auto</span> <span class="n">idx_op1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>      <span class="p">(</span><span class="n">token_aa</span><span class="p">));</span><span class="c1">//string_view = &quot;___j&quot;</span>
</code></pre></div>
<img alt="assign" src="../graphviz/function_call_exp.png" /></p>
<div class="highlight"><pre><span></span><code>// Pyrope
val = 1023u10bits
</code></pre></div>
<h1 id="attribute-statement">Attribute statement</h1>
<p>There are two ways to set an attribute to a variable or tuple, 
using "." dot operator directly or using as (__attr = foo).
An classical attribute setting is bitwidth assignment.</p>
<div class="highlight"><pre><span></span><code>// Pyrope
foo.__bits = 3
foo = 7

bar as (__bits = 10)
bar = 123
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1">// Verilog</span>
<span class="kt">wire</span> <span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">foo</span><span class="p">;</span>
<span class="kt">wire</span> <span class="p">[</span><span class="mh">9</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">bar</span><span class="p">;</span>

<span class="k">assign</span> <span class="n">foo</span> <span class="o">=</span> <span class="mh">7</span><span class="p">;</span>
<span class="k">assign</span> <span class="n">bar</span> <span class="o">=</span> <span class="mh">123</span><span class="p">;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>// CFG
<span class="m">1</span>       <span class="m">0</span>       <span class="m">0</span>       SEQ0
<span class="m">2</span>       <span class="m">1</span>       <span class="m">0</span>       <span class="m">0</span>       <span class="m">14</span>      .       ___a    foo     __bits
<span class="m">3</span>       <span class="m">1</span>       <span class="m">1</span>       <span class="m">0</span>       <span class="nv">14</span>      <span class="o">=</span>       ___a    0d3
<span class="m">4</span>       <span class="m">1</span>       <span class="m">2</span>       <span class="m">15</span>      <span class="nv">22</span>      <span class="o">=</span>       foo     0d7
<span class="m">5</span>       <span class="m">1</span>       <span class="m">0</span>       TUP0    ___b
<span class="m">6</span>       <span class="m">5</span>       <span class="m">3</span>       <span class="m">24</span>      <span class="nv">44</span>      <span class="o">=</span>       __bits  0d10
<span class="m">7</span>       <span class="m">1</span>       <span class="m">4</span>       <span class="m">24</span>      <span class="m">44</span>      as      bar     ___b
<span class="m">8</span>       <span class="m">1</span>       <span class="m">5</span>       <span class="m">45</span>      <span class="nv">54</span>      <span class="o">=</span>       bar     0d123
</code></pre></div>
<p><div class="highlight"><pre><span></span><code><span class="c1">// C++</span>

<span class="k">auto</span> <span class="n">idx_dot</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_dot</span>    <span class="p">(</span><span class="n">token1</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs1</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_dot</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token2</span><span class="p">));</span> <span class="c1">// string_view = ___a</span>
<span class="k">auto</span> <span class="n">idx_op1</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_dot</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token3</span><span class="p">));</span> <span class="c1">// string_view = foo       </span>
<span class="k">auto</span> <span class="n">idx_op2</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_dot</span><span class="p">,</span>   <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>    <span class="p">(</span><span class="n">token4</span><span class="p">));</span> <span class="c1">// string_view = __bits       </span>

<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">(</span><span class="n">token5</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs2</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token6</span><span class="p">));</span> <span class="c1">// string_view = ___a</span>
<span class="k">auto</span> <span class="n">idx_op3</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span> <span class="p">(</span><span class="n">token7</span><span class="p">));</span> <span class="c1">// string_view = 0d3       </span>


<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">(</span><span class="n">token8</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs2</span>   <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">token9</span><span class="p">));</span> <span class="c1">// string_view = foo</span>
<span class="k">auto</span> <span class="n">idx_op3</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span> <span class="p">(</span><span class="n">tokena</span><span class="p">));</span> <span class="c1">// string_view = 0d7       </span>

<span class="k">auto</span> <span class="n">idx_tup</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_tuple</span> <span class="p">(</span><span class="n">tokenb</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_tname</span>  <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">tokenc</span><span class="p">));</span> <span class="c1">// string_view = ___b</span>

<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_tup</span><span class="p">,</span>    <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">(</span><span class="n">tokend</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">tokene</span><span class="p">));</span> <span class="c1">//string_view = &quot;__bits&quot;</span>
<span class="k">auto</span> <span class="n">idx_op4</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span> <span class="p">(</span><span class="n">tokenf</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d10&quot;</span>


<span class="k">auto</span> <span class="n">idx_as</span>     <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_as</span>    <span class="p">(</span><span class="n">tokeng</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">tokenh</span><span class="p">));</span> <span class="c1">//string_view = &quot;bar&quot;</span>
<span class="k">auto</span> <span class="n">idx_op5</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">tokeni</span><span class="p">));</span> <span class="c1">//string_view = &quot;___b&quot;</span>

<span class="k">auto</span> <span class="n">idx_assign</span> <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_stmts</span><span class="p">,</span>  <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_assign</span><span class="p">(</span><span class="n">tokenj</span><span class="p">));</span>
<span class="k">auto</span> <span class="n">idx_lhs</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_ref</span>   <span class="p">(</span><span class="n">tokenk</span><span class="p">));</span> <span class="c1">//string_view = &quot;bar&quot;</span>
<span class="k">auto</span> <span class="n">idx_op6</span>    <span class="o">=</span> <span class="n">lnast</span><span class="o">-&gt;</span><span class="n">add_child</span><span class="p">(</span><span class="n">idx_assign</span><span class="p">,</span> <span class="n">Lnast_node</span><span class="o">::</span><span class="n">create_const</span> <span class="p">(</span><span class="n">tokenk</span><span class="p">));</span> <span class="c1">//string_view = &quot;0d123&quot;</span>
</code></pre></div>
<img alt="assign" src="../graphviz/attribute.png" /></p>
<h1 id="string-management">String management</h1>
<p>LNAST has to handle lots of strings. Each LNAST node has several strings, for
example, the simple "ref" node has 2 strings: the variable name and the
contents.</p>
<p>The LNAST interface does not allocate strings when passed as arguments. The reason
is that it accepts std::string_view as argument. The LNAST internals assume that someone
else handles the string allocations. A code like this will result in incorrect behaviour:</p>
<div class="highlight"><pre><span></span><code>// WARNING: INCORRECT CODE
std::string str{&quot;foo&quot;};
str += &quot;bar&quot;;
auto Lnast_node::create_ref(str);
</code></pre></div>
<p>The reason is that str is allocated at the stack, and after the function
returns LNAST will have a pointer to incorrect memory region.</p>
<p>The solution is that for newly created strings, the "add_string" API must be called.</p>
<div class="highlight"><pre><span></span><code>// CORRECT CODE to handle strings in LNAST
std::string str{&quot;foo&quot;};
str += &quot;bar&quot;;
auto Lnast_node::create_ref(lnast-&gt;add_string(str));
</code></pre></div>
<p>The add_string allocates a string inside lnast. When the lnast is de-allocated
the string is garbage collected.</p>
<p>LNAST is optimized to operate with scanner parsers. When LNAST is built, it is possible to 
pass a memory region mmaped with all the strings used by the scanner. In this case, the 
LNAST can get ownership of a large memory region with all the strings used by the scanner.</p>
<div class="highlight"><pre><span></span><code>// LNAST mmap support
std::pair&lt;std::string_view, int&gt; own;
// own.first points to the mmap region that lnast will munmap at the end
// own.second points to the file descriptor associated to the mmap that must be closed
lnast = std::make_unique&lt;Lnast&gt;(&quot;top_name&quot;, own);
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../02-lgraph/" class="md-footer__link md-footer__link--prev" aria-label="Previous: LGraph" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              LGraph
            </div>
          </div>
        </a>
      
      
        
        <a href="../03c-mmapstr/" class="md-footer__link md-footer__link--next" aria-label="Next: mmap_lib::str" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              mmap_lib::str
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.instant", "navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.2b46852b.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>