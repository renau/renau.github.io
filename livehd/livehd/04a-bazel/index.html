
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.2">
    
    
      
        <title>Bazel build - LiveHD and Pyrope</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.1118c9be.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ba0d045b.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=:300,400,400i,700%7CFira+Code&display=fallback">
        <style>:root{--md-text-font-family:"";--md-code-font-family:"Fira Code"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
      <script>var palette=__get("__palette");if(null!==palette&&"object"==typeof palette.color)for(var key in palette.color)document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#bazel-build" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LiveHD and Pyrope" class="md-header__button md-logo" aria-label="LiveHD and Pyrope" data-md-component="logo">
      
  <img src="../../assets/pyrope5.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LiveHD and Pyrope
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Bazel build
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 10a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2 2 2 0 0 1 2-2m10-3a5 5 0 0 1 5 5 5 5 0 0 1-5 5H7a5 5 0 0 1-5-5 5 5 0 0 1 5-5h10M7 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3h10a3 3 0 0 0 3-3 3 3 0 0 0-3-3H7z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/masc-ucsc/livehd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LiveHD and Pyrope" class="md-nav__button md-logo" aria-label="LiveHD and Pyrope" data-md-component="logo">
      
  <img src="../../assets/pyrope5.png" alt="logo">

    </a>
    LiveHD and Pyrope
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/masc-ucsc/livehd" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        LiveHD and Pyrope
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      <label class="md-nav__link" for="__nav_2">
        Livehd
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Livehd" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Livehd
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01-install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../01-usage/" class="md-nav__link">
        Getting started
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../02-lgraph/" class="md-nav__link">
        LGraph
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../03-lnast/" class="md-nav__link">
        LNAST
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../03c-mmapstr/" class="md-nav__link">
        mmap_lib::str
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Bazel build
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Bazel build
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#release-vs-fastbuild-default-vs-debug" class="md-nav__link">
    Release vs fastbuild (default) vs debug
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-the-commands-executed" class="md-nav__link">
    See the commands executed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keep-all-the-files-in-bazel-run-for-debugging" class="md-nav__link">
    Keep all the files in bazel run for debugging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-run-fixme-tests" class="md-nav__link">
    To run FIXME tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-bazel-targets-starting-from-top-directory" class="md-nav__link">
    List bazel targets starting from top directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-bazel-targets-starting-from-any-directory" class="md-nav__link">
    List bazel targets starting from any directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-files-needed-for-a-given-target" class="md-nav__link">
    List files needed for a given target
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-all-the-passes-that-use-core-those-should-be-listed-at-mainbuild-deps" class="md-nav__link">
    List all the passes that use core (those should be listed at main/BUILD deps)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clear-out-cache-not-needed-in-most-cases" class="md-nav__link">
    Clear out cache (not needed in most cases)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-run-long-tests" class="md-nav__link">
    To run LONG tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-with-bazel" class="md-nav__link">
    Debugging with bazel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-create-a-fully-static-binary" class="md-nav__link">
    To create a fully static binary
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../04b-pass/" class="md-nav__link">
        Creating a Pass
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../04c-github/" class="md-nav__link">
        GitHub Guide
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../04d-style/" class="md-nav__link">
        Coding Style
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Pyrope
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Pyrope" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Pyrope
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/02-basics/" class="md-nav__link">
        Basics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/03-bundle/" class="md-nav__link">
        Bundles
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/04-variables/" class="md-nav__link">
        Variables and types
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/05-assert/" class="md-nav__link">
        Assertions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/06-functions/" class="md-nav__link">
        Functions and methods
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/06b-pipelining/" class="md-nav__link">
        Pipelining
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/07-typesystem/" class="md-nav__link">
        Type system
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../pyrope/09-stdlib/" class="md-nav__link">
        Pyrope std lib
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#release-vs-fastbuild-default-vs-debug" class="md-nav__link">
    Release vs fastbuild (default) vs debug
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#see-the-commands-executed" class="md-nav__link">
    See the commands executed
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keep-all-the-files-in-bazel-run-for-debugging" class="md-nav__link">
    Keep all the files in bazel run for debugging
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-run-fixme-tests" class="md-nav__link">
    To run FIXME tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-bazel-targets-starting-from-top-directory" class="md-nav__link">
    List bazel targets starting from top directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-bazel-targets-starting-from-any-directory" class="md-nav__link">
    List bazel targets starting from any directory
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-files-needed-for-a-given-target" class="md-nav__link">
    List files needed for a given target
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#list-all-the-passes-that-use-core-those-should-be-listed-at-mainbuild-deps" class="md-nav__link">
    List all the passes that use core (those should be listed at main/BUILD deps)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clear-out-cache-not-needed-in-most-cases" class="md-nav__link">
    Clear out cache (not needed in most cases)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-run-long-tests" class="md-nav__link">
    To run LONG tests
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#debugging-with-bazel" class="md-nav__link">
    Debugging with bazel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#to-create-a-fully-static-binary" class="md-nav__link">
    To create a fully static binary
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="bazel-build">Bazel build</h1>
<p>Bazel is a relatively new build system open sourced by google. The main difference
with traditional Makefiles is that it checks to make sure that dependences are not
lost and the builds are reproducible and hermetic. This document explains how
to use Bazel in the LGraph project.</p>
<p>Build targets are referred to using the syntax <code>//&lt;relative path to BUILD file&gt;:&lt;executable&gt;</code>, where
<code>//</code> is the path of the root livehd directory.</p>
<p>To build the LiveHD shell and supporting libraries, the target would be <code>//main:all</code>.
To build every target in LiveHD (helpful for checking if changes cause compilation failures), the target would be <code>//:...</code>.  For more details on target syntax, see <a href="https://docs.bazel.build/versions/master/guide.html#target-patterns">this</a> page.</p>
<h2 id="release-vs-fastbuild-default-vs-debug">Release vs fastbuild (default) vs debug</h2>
<p>For debugging/development use <code>-c dbg</code>, for benchmarking and testing <code>-c opt</code>.</p>
<ul>
<li>
<p>Fast build: no optimization, minimal debugging information (no local variable information), assertions turned on (default)
<div class="highlight"><pre><span></span><code>$ bazel build &lt;target&gt;
</code></pre></div></p>
</li>
<li>
<p>Debug build: some optimization, full debugging information, assertions turned on
<div class="highlight"><pre><span></span><code>$ bazel build -c dbg &lt;target&gt;
</code></pre></div></p>
</li>
</ul>
<p>or use address sanitizer to detect memory leaks
<div class="highlight"><pre><span></span><code>$ bazel build -c dbg --config asan //...
</code></pre></div></p>
<p>or use thread sanitizer to detect data races
<div class="highlight"><pre><span></span><code>$ bazel build -c dbg --config tsan //...
</code></pre></div></p>
<ul>
<li>
<p>Release build: most optimization, no debug symbols, assertions turned off
<div class="highlight"><pre><span></span><code>$ bazel build -c opt &lt;target&gt;
</code></pre></div></p>
</li>
<li>
<p>Benchmarking build: aggressive optimization for the current architecture (binary may not be portable!)
<div class="highlight"><pre><span></span><code>$ bazel build --config=bench &lt;target&gt;
</code></pre></div></p>
</li>
</ul>
<h2 id="see-the-commands-executed">See the commands executed</h2>
<p>The bazel '-s' option prints the command executed. The sandbox may still be deleted.</p>
<div class="highlight"><pre><span></span><code>$ bazel build -s //main:all
</code></pre></div>
<h2 id="keep-all-the-files-in-bazel-run-for-debugging">Keep all the files in bazel run for debugging</h2>
<p>Bazel runs process in a sandbox what it is deleted after each run. To preserve it for debugging a failing test.</p>
<div class="highlight"><pre><span></span><code>bazel test --sandbox_debug -c dbg //YOUR_TEST_HERE
</code></pre></div>
<p>Check the failing log, it will show you the sandbox location. You can change directory to it, and debug as usual.</p>
<h2 id="to-run-fixme-tests">To run FIXME tests</h2>
<p>Many times, we have new tests that make the regression fail. We use "fixme" if
the test is a new one and LGraph is still not patched. We want the test in the system,
but we do not want to make fail the regressions.</p>
<p>Those tests are marked with tags "fixme" in the BUILD. E.g:</p>
<pre><code>sh_test(
    name = "my_test.sh",
    tags = ["fixme"],  # This is a fixme test. It fails, but we should fix it
    srcs = ["tests/pyrope_test.sh"],
</code></pre>
<p>To run all the fixme tests
<div class="highlight"><pre><span></span><code>$ bazel test --test_tag_filters &quot;fixme&quot; &lt;target&gt;
</code></pre></div>
To list all the fixme tests (the goal is to have zero)
<div class="highlight"><pre><span></span><code>$ bazel query &#39;attr(tags, fixme, tests(&lt;target&gt;))&#39;
</code></pre></div></p>
<h2 id="list-bazel-targets-starting-from-top-directory">List bazel targets starting from top directory</h2>
<div class="highlight"><pre><span></span><code>$ bazel query &lt;target&gt;
</code></pre></div>
<h2 id="list-bazel-targets-starting-from-any-directory">List bazel targets starting from any directory</h2>
<div class="highlight"><pre><span></span><code>$ bazel query &lt;target&gt;
</code></pre></div>
<h2 id="list-files-needed-for-a-given-target">List files needed for a given target</h2>
<div class="highlight"><pre><span></span><code>$ bazel query &quot;deps(&lt;target&gt;)&quot;
</code></pre></div>
<h2 id="list-all-the-passes-that-use-core-those-should-be-listed-at-mainbuild-deps">List all the passes that use core (those should be listed at main/BUILD deps)</h2>
<div class="highlight"><pre><span></span><code>$ bazel query &quot;rdeps(//pass/..., //core:all)&quot; | grep pass_
</code></pre></div>
<h2 id="clear-out-cache-not-needed-in-most-cases">Clear out cache (not needed in most cases)</h2>
<p>This command is useful for benchmarking build time, and when system parameters change (the compiler gets upgraded, for example)
<div class="highlight"><pre><span></span><code>$ bazel clean --expunge
</code></pre></div></p>
<h2 id="to-run-long-tests">To run LONG tests</h2>
<p>In addition to the short tests, there are sets of long tests that are run frequently
but not before every push to main line. The reason is that those are multi-hour
tests.
<div class="highlight"><pre><span></span><code>$ bazel test --test_tag_filters &quot;long1&quot; &lt;target&gt;
</code></pre></div>
There are up to 8 long tests categories (long1, long2, long3...). Each of those
tests groups should last less than 4 hours when running in a dual core machine
(travis or azure).</p>
<p>To list the tests under each tag. E.g., to list all the tests with long1 tag.
<div class="highlight"><pre><span></span><code>$ bazel query &#39;attr(tags, long1, tests(&lt;target&gt;))&#39;
</code></pre></div></p>
<h2 id="debugging-with-bazel">Debugging with bazel</h2>
<p>First run the tests to see the failing one. Then run with debug options
the failing test. E.g:
<div class="highlight"><pre><span></span><code>$ bazel run -c dbg //eprp:all
</code></pre></div>
Increase logging level if wanted
<div class="highlight"><pre><span></span><code>$ LGRAPH_LOG=info bazel run -c dbg //eprp:all
</code></pre></div>
To run with gdb
<div class="highlight"><pre><span></span><code>$ bazel build -c dbg //eprp:eprp_test
$ gdb bazel-bin/eprp/eprp_test
(gdb) b Eprp::run
(gdb) r
</code></pre></div>
(lldb is also supported.)</p>
<h2 id="to-create-a-fully-static-binary">To create a fully static binary</h2>
<p>In the cc_binary of the relevant BUILD file, add <code>linkopts = ['-static']</code></p>
<p>Notice that the lgshell still needs the directory inside
<code>bazel-bin/main/lgshell.runfiles when using inou.yosys.\*</code></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../03c-mmapstr/" class="md-footer__link md-footer__link--prev" aria-label="Previous: mmap_lib::str" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              mmap_lib::str
            </div>
          </div>
        </a>
      
      
        
        <a href="../04b-pass/" class="md-footer__link md-footer__link--next" aria-label="Next: Creating a Pass" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Creating a Pass
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.instant", "navigation.indexes"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.2b46852b.min.js"></script>
      
        <script src="../../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
      
    
  </body>
</html>